<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Scoreboard - Dark Neon</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyCIyOhT468vnTtk1EaZ0SxDWoXITMrdopY",
    authDomain: "livescoreboard-a3971.firebaseapp.com",
    databaseURL: "https://livescoreboard-a3971-default-rtdb.firebaseio.com/",
    projectId: "livescoreboard-a3971",
    storageBucket: "livescoreboard-a3971.firebasestorage.app",
    messagingSenderId: "982242986492",
    appId: "1:982242986492:web:a2bb3b21490193b8cf4a79"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body {
    margin:0;
    padding:0;
    font-family:'Poppins', sans-serif;
    background: #0a0f1e;
    color:white;
    text-align:center;
    overflow-x:hidden;
}
h1 {
    font-size:42px;
    margin:20px 0;
    text-shadow:0 0 15px #00eaff,0 0 25px #00bfff;
    animation: glowHeading 2s ease-in-out infinite alternate;
}
@keyframes glowHeading{
    0%{text-shadow:0 0 15px #00eaff,0 0 25px #00bfff;}
    100%{text-shadow:0 0 25px #ff00ff,0 0 50px #ff00ff;}
}

.controls {
    margin:10px 0;
    position: fixed;
    top:10px;
    left:10px;
    z-index:1000;
}
button {
    margin:0 4px;
    padding:8px 12px;
    border:none;
    border-radius:6px;
    font-size:14px;
    cursor:pointer;
    transition:.2s;
}
button.primary { background: #00eaff; color:#012; font-weight:600; }
button.primary:hover { background:#00bfff; }
button.muted { background: rgba(255,255,255,0.08); color:#fff; }
button.muted:hover { background: rgba(255,255,255,0.15); }
button.danger { background:#ff6b6b; color:#111; }

#controlMenu {
    display: none;
    position: absolute;
    top: 50px;
    left: 0;
    background: rgba(0,0,0,0.85);
    padding: 8px;
    border-radius: 6px;
    z-index: 1000;
    white-space: nowrap;
}
#controlMenu button {
    display: block;
    margin: 6px 0;
    width: 200px;
    text-align: left;
    font-size:14px;
}

.container { width: 100%; margin:100px auto 20px; overflow:auto; transform-origin: top left; }
table { width:100%; border-collapse: collapse; background: rgba(255,255,255,0.03); border-radius:10px; overflow:hidden; table-layout:auto; }
th, td { padding:6px 8px; border-bottom:1px solid rgba(255,255,255,0.1); text-align:center; vertical-align:middle; font-size:16px; }
th { background: rgba(0,230,255,0.1); color:#00eaff; }

.school-cell {
    max-width: 300px;
    min-width: 180px;
    word-wrap: break-word;
    white-space: normal;
    font-weight:700;
    background: rgba(255,255,255,0.9);
    color:#000;
    border-radius:6px;
    padding:6px 10px;
    margin:2px auto;
    display:inline-block;
}

.total { font-weight:800; font-size:20px; }

.gold { animation: glowGold 1.5s infinite alternate; }
.silver { animation: glowSilver 1.5s infinite alternate; }
.bronze { animation: glowBronze 1.5s infinite alternate; }
@keyframes glowGold {0%{background:#ffd70055;}100%{background:#ffd70022;}}
@keyframes glowSilver {0%{background:#c0c0c055;}100%{background:#c0c0c022;}}
@keyframes glowBronze {0%{background:#cd7f3255;}100%{background:#cd7f3222;}}

#winnerPopup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: linear-gradient(90deg,#00eaff,#ff00ff,#00ff00);
    color: #000;
    padding: 30px 50px;
    font-size:36px;
    font-weight:900;
    border-radius: 20px;
    box-shadow: 0 0 30px #00eaff, 0 0 50px #ff00ff, 0 0 70px #00ff00;
    text-align: center;
    z-index: 9999;
    text-transform: uppercase;
    white-space: pre-line;
    animation: popUp 0.6s forwards;
}
@keyframes popUp {
    0% { transform: translate(-50%, -50%) scale(0); opacity:0; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity:1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity:1; }
}
</style>
</head>
<body>

<h1>üèÜ LIVE SCOREBOARD üèÜ</h1>

<!-- Controls Menu -->
<div class="controls">
  <button class="primary" onclick="toggleControls()">‚ò∞ Menu</button>
  <div id="controlMenu">
    <button class="primary" onclick="menuAction(downloadExcel)">Download Excel</button>
    <button class="muted" onclick="menuAction(downloadPDF)">Download PDF</button>
    <button class="primary" onclick="menuAction(showWinner)">üèÜ Winners</button>
  </div>
</div>

<div class="container">
<table id="scoreTable">
<thead>
<tr>
<th>School Name</th>
<th>‡§ó‡•Ä‡§∞‡•ç‡§µ‡§æ‡§£‡§ó‡§æ‡§®‡§Æ‡•ç</th>
<th>Fandom Fiesta</th>
<th>ChipkuChikpu</th>
<th>Gen Alpha Scientist</th>
<th>Our state,our legacy</th>
<th>‡§™‡§ü- ‡§¨‡•ã‡§≤‡§æ</th>
<th>‡§ï‡§æ‡§µ‡•ç‡§Ø‡§∏‡•É‡§ú‡§®</th>
<th>Math Champ</th>
<th>‡§•‡•ã‡§°‡•á‡§Ç ‡§Æ‡•ç‡§π‡§ú‡•á‡§Ç ‡§ñ‡•Ç‡§¨ ‡§§‡•Å‡§ú‡•á‡§Ç</th>
<th>Total Points</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<div id="winnerPopup" style="display:none;"></div>

<script>
const NUM = 9;

// Load Firebase data
function loadFromFirebase(){
    db.ref('scores').on('value', snapshot=>{
        const data = snapshot.val() || {};
        const tbody = document.querySelector("#scoreTable tbody");
        tbody.innerHTML="";
        for(const id in data){
            const schoolData = data[id];
            addSchoolRow(schoolData.name, schoolData.scores, id);
        }
        sortAndHighlight();
        adjustTableScale();
    });
}

// Add school row
function addSchoolRow(name="", scores=[], id=null){
    const tbody = document.querySelector("#scoreTable tbody");
    const tr = document.createElement("tr");
    if(!id) id = db.ref('scores').push().key;
    tr.setAttribute('data-id', id);

    const scoreTds = scores.map(s=>`<td>${s}</td>`).join('');
    const total = scores.reduce((a,b)=>a+b,0);
    tr.innerHTML = `<td class="school-cell">${name}</td>${scoreTds}<td class="total">${total}</td>`;
    tbody.appendChild(tr);
}

// Sort rows
function sortAndHighlight(){
    const tbody = document.querySelector("#scoreTable tbody");
    const rows = Array.from(tbody.querySelectorAll('tr'));
    rows.sort((a,b)=> Number(b.querySelector('.total').textContent)-Number(a.querySelector('.total').textContent));
    rows.forEach((row, idx)=>{
        row.classList.remove('gold','silver','bronze');
        if(idx===0) row.classList.add('gold');
        else if(idx===1) row.classList.add('silver');
        else if(idx===2) row.classList.add('bronze');
        tbody.appendChild(row);
    });
}

// Menu functions
function toggleControls(){
    const menu=document.getElementById('controlMenu');
    menu.style.display = (menu.style.display==='none')?'block':'none';
}
function menuAction(fn){
    fn();
    document.getElementById('controlMenu').style.display='none';
}

// Adjust table scaling
function adjustTableScale(){
    const container = document.querySelector('.container');
    const table = document.getElementById('scoreTable');
    const scaleX = window.innerWidth / table.scrollWidth;
    const scaleY = (window.innerHeight-100) / table.scrollHeight;
    const scale = Math.min(scaleX, scaleY, 1);
    container.style.transform = `scale(${scale})`;
}
window.addEventListener('resize', adjustTableScale);

// PDF & Excel export
async function downloadPDF(){ 
    const tableWrap=document.querySelector(".container");
    const canvas=await html2canvas(tableWrap,{scale:2,backgroundColor:getComputedStyle(document.body).backgroundColor});
    const imgData=canvas.toDataURL('image/png');
    const {jsPDF}=window.jspdf;
    const pdf=new jsPDF('l','pt','a4');
    const pdfWidth=pdf.internal.pageSize.getWidth();
    const imgWidth=pdfWidth-40;
    const imgHeight=(canvas.height*imgWidth)/canvas.width;
    pdf.addImage(imgData,'PNG',20,20,imgWidth,imgHeight);
    pdf.save(`scoreboard_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'_')}.pdf`);
}
function downloadExcel(){
    const rows=[["School","‡§ó‡•Ä‡§∞‡•ç‡§µ‡§æ‡§£‡§ó‡§æ‡§®‡§Æ‡•ç","Fandom Fiesta","ChipkuChikpu","Gen Alpha Scientist","Our state,our legacy","‡§™‡§ü- ‡§¨‡•ã‡§≤‡§æ","‡§ï‡§æ‡§µ‡•ç‡§Ø‡§∏‡•É‡§ú‡§®","Math Champ","‡§•‡•ã‡§°‡•á‡§Ç ‡§Æ‡•ç‡§π‡§ú‡•á‡§Ç ‡§ñ‡•Ç‡§¨ ‡§§‡•Å‡§ú‡•á‡§Ç","Total"]];
    const trs=Array.from(document.querySelectorAll("#scoreTable tbody tr"));
    trs.forEach(tr=>{ const cols=Array.from(tr.querySelectorAll('td')).map(td=>td.textContent); rows.push(cols); });
    const ws=XLSX.utils.aoa_to_sheet(rows);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"Scores");
    XLSX.writeFile(wb,`scoreboard_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'_')}.xlsx`);
}

// Winner popup
function showWinner(){
    const tbody=document.querySelector("#scoreTable tbody");
    const rows=Array.from(tbody.querySelectorAll('tr'));
    if(rows.length===0) return alert("No schools available!");
    let maxTotal = Math.max(...rows.map(r=>Number(r.querySelector('.total').textContent)));
    let winners = rows.filter(r=>Number(r.querySelector('.total').textContent)===maxTotal);
    if(winners.length===0) return;
    const popup = document.getElementById('winnerPopup');
    popup.style.display='block';
    popup.innerHTML = winners.map(r=>r.querySelector('td').textContent).join('\nüèÜ\n');
    popup.style.animation = 'popUp 0.6s forwards';
    setTimeout(()=>{ popup.style.display='none'; },10000);
}

// Initialize
loadFromFirebase();
</script>

</body>
</html>
